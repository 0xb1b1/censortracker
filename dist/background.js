module.exports =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/chrome/js/background.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/chrome/js/background.js":
/*!*************************************!*\
  !*** ./src/chrome/js/background.js ***!
  \*************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./core */ \"./src/chrome/js/core/index.js\");\n\nvar REQUEST_FILTERS = {\n  urls: ['*://*/*'],\n  types: ['main_frame']\n};\nvar MAX_REDIRECTIONS_COUNT = 6;\nvar ERR_CONNECTION_RESET = 'ERR_CONNECTION_RESET';\nvar ERR_CONNECTION_CLOSED = 'ERR_CONNECTION_CLOSED';\nvar ERR_CERT_COMMON_NAME_INVALID = 'ERR_CERT_COMMON_NAME_INVALID';\nvar ERR_HTTP2_PROTOCOL_ERROR = 'ERR_HTTP2_PROTOCOL_ERROR';\nvar ERR_TUNNEL_CONNECTION_FAILED = 'ERR_TUNNEL_CONNECTION_FAILED';\nvar ERR_CERT_AUTHORITY_INVALID = 'ERR_CERT_AUTHORITY_INVALID';\nvar ERR_CONNECTION_TIMED_OUT = 'ERR_CONNECTION_TIMED_OUT';\nvar RED_ICON = chrome.extension.getURL('images/red_icon.png');\n\nvar onInstalled = function onInstalled(details) {\n  if (details.reason === 'install') {\n    _core__WEBPACK_IMPORTED_MODULE_0__[\"proxies\"].openPorts();\n    _core__WEBPACK_IMPORTED_MODULE_0__[\"shortcuts\"].enableExtension();\n    _core__WEBPACK_IMPORTED_MODULE_0__[\"registry\"].syncDatabase();\n    _core__WEBPACK_IMPORTED_MODULE_0__[\"proxies\"].setProxy();\n  }\n};\n\nvar onWindowsRemoved = function onWindowsRemoved(_windowId) {\n  chrome.storage.local.remove(['notifiedHosts']);\n};\n\nvar onStartup = function onStartup() {\n  _core__WEBPACK_IMPORTED_MODULE_0__[\"registry\"].syncDatabase();\n  updateState();\n};\n\nvar onBeforeRequest = function onBeforeRequest(details) {\n  if (_core__WEBPACK_IMPORTED_MODULE_0__[\"shortcuts\"].validURL(details.url)) {\n    return {\n      redirectUrl: details.url.replace(/^http:/, 'https:')\n    };\n  }\n\n  return null;\n};\n\nvar onBeforeRedirect = function onBeforeRedirect(details) {\n  var requestId = details.requestId;\n  var urlObject = new URL(details.url);\n  var hostname = urlObject.hostname;\n  var count = _core__WEBPACK_IMPORTED_MODULE_0__[\"sessions\"].getRequest(requestId, 'redirect_count', 0);\n\n  if (count) {\n    _core__WEBPACK_IMPORTED_MODULE_0__[\"sessions\"].putRequest(requestId, 'redirect_count', count + 1);\n  } else {\n    _core__WEBPACK_IMPORTED_MODULE_0__[\"sessions\"].putRequest(requestId, 'redirect_count', 1);\n  }\n\n  if (count >= MAX_REDIRECTIONS_COUNT) {\n    if (chrome.webRequest.onBeforeRequest.hasListener(onBeforeRequest)) {\n      chrome.webRequest.onBeforeRequest.removeListener(onBeforeRequest);\n    }\n\n    chrome.storage.local.get({\n      ignoredSites: []\n    }, function (data) {\n      var ignoredSites = data.ignoredSites;\n\n      if (!ignoredSites.includes(hostname)) {\n        ignoredSites.push(hostname);\n        console.warn(\"Too many redirections. Site \".concat(hostname, \" add to ignore\"));\n        chrome.storage.local.set({\n          ignoredSites: ignoredSites\n        });\n      }\n    });\n  }\n};\n\nvar onErrorOccurred = function onErrorOccurred(details) {\n  // Removes \"net::\" from string\n  var error = details.error.substr(5);\n  var urlObject = new URL(details.url);\n  var hostname = urlObject.hostname;\n  var encodedURL = window.btoa(details.url); // Most likely in this case domain was blocked by DPI\n\n  if (error === ERR_CONNECTION_RESET || error === ERR_CONNECTION_CLOSED || error === ERR_CONNECTION_TIMED_OUT) {\n    _core__WEBPACK_IMPORTED_MODULE_0__[\"proxies\"].setProxy(hostname);\n    _core__WEBPACK_IMPORTED_MODULE_0__[\"registry\"].reportBlockedByDPI(hostname);\n    chrome.tabs.update({\n      url: chrome.runtime.getURL(\"pages/refused.html?\".concat(encodedURL))\n    });\n  }\n\n  if (error === ERR_HTTP2_PROTOCOL_ERROR || error === ERR_CERT_COMMON_NAME_INVALID || error === ERR_TUNNEL_CONNECTION_FAILED || error === ERR_CERT_AUTHORITY_INVALID) {\n    console.warn('Certificate validation issue. Adding hostname to ignore...');\n    chrome.storage.local.get({\n      ignoredSites: []\n    }, function (data) {\n      var ignoredSites = data.ignoredSites;\n\n      if (!ignoredSites.includes(hostname)) {\n        ignoredSites.push(hostname);\n        chrome.storage.local.set({\n          ignoredSites: ignoredSites\n        });\n      }\n\n      if (chrome.webRequest.onBeforeRequest.hasListener(onBeforeRequest)) {\n        chrome.webRequest.onBeforeRequest.removeListener(onBeforeRequest);\n      }\n\n      chrome.tabs.update({\n        url: details.url.replace('https:', 'http:')\n      });\n    });\n  }\n};\n\nvar onCompleted = function onCompleted(details) {\n  _core__WEBPACK_IMPORTED_MODULE_0__[\"sessions\"].deleteRequest(details.requestId);\n\n  if (!chrome.webRequest.onBeforeRequest.hasListener(onBeforeRequest)) {\n    chrome.webRequest.onBeforeRequest.addListener(onBeforeRequest, REQUEST_FILTERS, ['blocking']);\n  }\n};\n\nvar notificationOnButtonClicked = function notificationOnButtonClicked(notificationId, buttonIndex) {\n  if (buttonIndex === 0) {\n    chrome.tabs.query({\n      active: true,\n      lastFocusedWindow: true\n    }, function (tabs) {\n      var activeTab = tabs[0];\n      var urlObject = new URL(activeTab.url);\n      var hostname = urlObject.hostname;\n      chrome.storage.local.get({\n        mutedForever: []\n      }, function (result) {\n        var mutedForever = result.mutedForever;\n\n        if (!mutedForever.find(function (item) {\n          return item === hostname;\n        })) {\n          mutedForever.push(hostname);\n          chrome.storage.local.set({\n            mutedForever: mutedForever\n          }, function () {\n            console.warn(\"Resource \".concat(hostname, \" added to ignore. We won't notify you about it anymore\"));\n          });\n        }\n      });\n    });\n  }\n};\n\nvar updateState = function updateState() {\n  chrome.storage.local.get({\n    enableExtension: true,\n    ignoredSites: []\n  }, function (config) {\n    chrome.tabs.query({\n      active: true,\n      lastFocusedWindow: true\n    }, function (tabs) {\n      var activeTab = tabs[0];\n      var tabId = activeTab.id;\n\n      if (!activeTab.url) {\n        return;\n      }\n\n      var urlObject = new URL(activeTab.url);\n\n      if (urlObject.protocol === 'chrome:') {\n        return;\n      }\n\n      var currentHostname = _core__WEBPACK_IMPORTED_MODULE_0__[\"shortcuts\"].cleanHostname(urlObject.hostname);\n      var ignoredSites = config.ignoredSites;\n\n      if (ignoredSites.includes(currentHostname)) {\n        console.warn(\"Site \".concat(currentHostname, \" found in ignore\"));\n        chrome.webRequest.onBeforeRequest.removeListener(onBeforeRequest);\n        return;\n      }\n\n      if (config.enableExtension) {\n        if (!chrome.webRequest.onBeforeRequest.hasListener(onBeforeRequest)) {\n          chrome.webRequest.onBeforeRequest.addListener(onBeforeRequest, REQUEST_FILTERS, ['blocking']);\n        }\n\n        if (!chrome.webRequest.onErrorOccurred.hasListener(onErrorOccurred)) {\n          chrome.webRequest.onErrorOccurred.addListener(onErrorOccurred, REQUEST_FILTERS);\n        }\n\n        _core__WEBPACK_IMPORTED_MODULE_0__[\"registry\"].checkDistributors(currentHostname, {\n          onMatchFound: function onMatchFound(cooperationRefused) {\n            setMatchFoundIcon(tabId);\n\n            if (!cooperationRefused) {\n              setCooperationAcceptedBadge(tabId);\n              showCooperationAcceptedWarning(currentHostname);\n            }\n          }\n        });\n        _core__WEBPACK_IMPORTED_MODULE_0__[\"registry\"].checkDomains(currentHostname, {\n          onMatchFound: function onMatchFound(_data) {\n            setMatchFoundIcon(tabId);\n          },\n          onMatchNotFound: function onMatchNotFound() {\n            _core__WEBPACK_IMPORTED_MODULE_0__[\"registry\"].checkDistributors(currentHostname, {\n              onMatchFound: function onMatchFound(cooperationRefused) {\n                if (!cooperationRefused) {\n                  setCooperationAcceptedBadge(tabId);\n                }\n              }\n            });\n          }\n        });\n      } else {\n        if (chrome.webRequest.onBeforeRequest.hasListener(onBeforeRequest)) {\n          chrome.webRequest.onBeforeRequest.removeListener(onBeforeRequest);\n        }\n\n        if (chrome.webRequest.onErrorOccurred.hasListener(onErrorOccurred)) {\n          chrome.webRequest.onErrorOccurred.removeListener(onErrorOccurred);\n        }\n      }\n    });\n  });\n};\n\nvar setMatchFoundIcon = function setMatchFoundIcon(tabId) {\n  chrome.browserAction.setIcon({\n    tabId: tabId,\n    path: RED_ICON\n  });\n};\n\nvar showCooperationAcceptedWarning = function showCooperationAcceptedWarning(hostname) {\n  chrome.storage.local.get({\n    notifiedHosts: [],\n    mutedForever: []\n  }, function (result) {\n    if (!result || !hostname) {\n      return;\n    }\n\n    var mutedForever = result.mutedForever;\n\n    if (mutedForever.find(function (item) {\n      return item === hostname;\n    })) {\n      return;\n    }\n\n    var notifiedHosts = result.notifiedHosts;\n\n    if (!notifiedHosts.find(function (item) {\n      return item === hostname;\n    })) {\n      chrome.notifications.create({\n        type: 'basic',\n        title: \"Censor Tracker: \".concat(hostname),\n        priority: 2,\n        message: 'Этот ресурс может передавать информацию третьим лицам.',\n        buttons: [{\n          title: \"\\u2715 \\u041D\\u0435 \\u043F\\u043E\\u043A\\u0430\\u0437\\u044B\\u0432\\u0430\\u0442\\u044C \\u0434\\u043B\\u044F \\u044D\\u0442\\u043E\\u0433\\u043E \\u0441\\u0430\\u0439\\u0442\\u0430\"\n        }, {\n          title: \"\\u2192 \\u041F\\u043E\\u0434\\u0440\\u043E\\u0431\\u043D\\u0435\\u0435\"\n        }],\n        iconUrl: RED_ICON\n      });\n    }\n\n    if (!notifiedHosts.includes(hostname)) {\n      notifiedHosts.push(hostname);\n      chrome.storage.local.set({\n        notifiedHosts: notifiedHosts\n      }, function () {\n        console.warn('The list of the notified ORI resource updated!');\n      });\n    }\n  });\n};\n\nvar setCooperationAcceptedBadge = function setCooperationAcceptedBadge(tabId) {\n  chrome.browserAction.setBadgeBackgroundColor({\n    color: '#F93E2D',\n    tabId: tabId\n  });\n  chrome.browserAction.setBadgeText({\n    text: \"\\u2691\",\n    tabId: tabId\n  });\n  chrome.browserAction.setTitle({\n    title: _core__WEBPACK_IMPORTED_MODULE_0__[\"settings\"].getTitle(),\n    tabId: tabId\n  });\n};\n\nchrome.runtime.onInstalled.addListener(onInstalled);\nchrome.windows.onRemoved.addListener(onWindowsRemoved);\nchrome.runtime.onStartup.addListener(onStartup);\nchrome.webRequest.onErrorOccurred.addListener(onErrorOccurred, REQUEST_FILTERS);\nchrome.webRequest.onBeforeRequest.addListener(onBeforeRequest, REQUEST_FILTERS, ['blocking']);\nchrome.webRequest.onBeforeRedirect.addListener(onBeforeRedirect, {\n  urls: ['*://*/*']\n});\nchrome.webRequest.onCompleted.addListener(onCompleted, {\n  urls: ['*://*/*']\n});\nchrome.notifications.onButtonClicked.addListener(notificationOnButtonClicked);\nchrome.tabs.onActivated.addListener(updateState);\nchrome.tabs.onUpdated.addListener(updateState);\nsetInterval(function () {\n  _core__WEBPACK_IMPORTED_MODULE_0__[\"proxies\"].openPorts();\n}, 60 * 1000 * 3);\n\n//# sourceURL=webpack:///./src/chrome/js/background.js?");

/***/ }),

/***/ "./src/chrome/js/core/database.js":
/*!****************************************!*\
  !*** ./src/chrome/js/core/database.js ***!
  \****************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar Database = /*#__PURE__*/function () {\n  function Database() {\n    _classCallCheck(this, Database);\n  }\n\n  _createClass(Database, [{\n    key: \"get\",\n    value: function get(key, defaultValue) {\n      return new Promise(function (resolve, reject) {\n        try {\n          chrome.storage.local.get(key, function (result) {\n            resolve(result);\n          });\n        } catch (error) {\n          reject(error);\n        }\n      });\n    }\n  }, {\n    key: \"set\",\n    value: function set(key, value) {\n      return new Promise(function (resolve, reject) {\n        try {\n          chrome.storage.local.set(_defineProperty({}, key, value), function () {\n            resolve(_defineProperty({}, key, value));\n          });\n        } catch (error) {\n          reject(error);\n        }\n      });\n    }\n  }]);\n\n  return Database;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Database);\n\n//# sourceURL=webpack:///./src/chrome/js/core/database.js?");

/***/ }),

/***/ "./src/chrome/js/core/index.js":
/*!*************************************!*\
  !*** ./src/chrome/js/core/index.js ***!
  \*************************************/
/*! exports provided: proxies, Database, registry, sessions, settings, shortcuts */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _proxies__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./proxies */ \"./src/chrome/js/core/proxies.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"proxies\", function() { return _proxies__WEBPACK_IMPORTED_MODULE_0__[\"default\"]; });\n\n/* harmony import */ var _database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./database */ \"./src/chrome/js/core/database.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"Database\", function() { return _database__WEBPACK_IMPORTED_MODULE_1__[\"default\"]; });\n\n/* harmony import */ var _registry__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./registry */ \"./src/chrome/js/core/registry.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"registry\", function() { return _registry__WEBPACK_IMPORTED_MODULE_2__[\"default\"]; });\n\n/* harmony import */ var _sessions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./sessions */ \"./src/chrome/js/core/sessions.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"sessions\", function() { return _sessions__WEBPACK_IMPORTED_MODULE_3__[\"default\"]; });\n\n/* harmony import */ var _settings__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./settings */ \"./src/chrome/js/core/settings.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"settings\", function() { return _settings__WEBPACK_IMPORTED_MODULE_4__[\"default\"]; });\n\n/* harmony import */ var _shortcuts__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./shortcuts */ \"./src/chrome/js/core/shortcuts.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"shortcuts\", function() { return _shortcuts__WEBPACK_IMPORTED_MODULE_5__[\"default\"]; });\n\n\n\n\n\n\n\n\n//# sourceURL=webpack:///./src/chrome/js/core/index.js?");

/***/ }),

/***/ "./src/chrome/js/core/proxies.js":
/*!***************************************!*\
  !*** ./src/chrome/js/core/proxies.js ***!
  \***************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index */ \"./src/chrome/js/core/index.js\");\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\nvar databaseName = 'censortracker-pac-domains';\nvar db = new _index__WEBPACK_IMPORTED_MODULE_0__[\"Database\"](databaseName);\nvar domainsApiUrl = window.censortracker.settings.getDomainsApiUrl();\n\nvar Proxies = function Proxies() {\n  var _this = this;\n\n  _classCallCheck(this, Proxies);\n\n  _defineProperty(this, \"setProxy\", function (hostname) {\n    _this.getBlockedDomains(function (domains) {\n      domains = _this.excludeSpecialDomains(domains);\n      chrome.storage.local.get({\n        blockedDomains: []\n      }, function (items) {\n        var blockedDomains = items.blockedDomains;\n\n        if (hostname) {\n          var domain = blockedDomains.find(function (element) {\n            return element.domain === hostname;\n          });\n\n          if (!domain) {\n            blockedDomains.push({\n              domain: hostname,\n              timestamp: new Date().getTime()\n            });\n          }\n        }\n\n        if (blockedDomains) {\n          domains = domains.concat(blockedDomains.map(function (obj) {\n            return obj.domain;\n          }));\n        }\n\n        chrome.storage.local.set({\n          blockedDomains: blockedDomains\n        }, function () {\n          if (hostname) {\n            console.log(\"Site \".concat(hostname, \" has been added to set of blocked by DPI.\"));\n          }\n        });\n\n        _this.setProxyAutoConfig(domains);\n      });\n    });\n  });\n\n  _defineProperty(this, \"getBlockedDomains\", function (callback) {\n    db.get('domains').then(function (domains) {\n      if (domains) {\n        console.warn('Fetching domains from local database...');\n        callback(domains);\n      } else {\n        console.warn('Fetching domains for PAC from registry API...');\n\n        _this.syncDatabaseWithRegistry(callback);\n      }\n    }).catch(function (error) {\n      console.error(error);\n    });\n  });\n\n  _defineProperty(this, \"syncDatabaseWithRegistry\", function (callback) {\n    fetch(domainsApiUrl).then(function (response) {\n      return response.json();\n    }).then(function (domains) {\n      db.set('domains', domains);\n      var date = new Date();\n      var time = \"\".concat(date.getHours(), \":\").concat(date.getMinutes());\n      console.warn(\"[\".concat(time, \"] Local database \\xAB\").concat(databaseName, \"\\xBB synchronized with registry!\"));\n\n      if (callback !== undefined) {\n        callback(domains);\n      }\n    }).catch(function (error) {\n      console.error(\"Error on fetching data from API: \".concat(error));\n    });\n  });\n\n  _defineProperty(this, \"excludeSpecialDomains\", function (domains) {\n    // ----------------- Testing -----------------\n    domains = domains.filter(function (item) {\n      return item !== 'rutracker.org';\n    });\n    domains = domains.filter(function (item) {\n      return item !== 'telegram.org';\n    });\n    domains = domains.filter(function (item) {\n      return item !== 'lostfilm.tv';\n    });\n    domains = domains.filter(function (item) {\n      return item !== 'tunnelbear.com';\n    }); // --------------------------------------------\n\n    var specialDomains = ['youtube.com'];\n    return domains.filter(function (domain) {\n      return !specialDomains.includes(domain);\n    });\n  });\n\n  _defineProperty(this, \"setProxyAutoConfig\", function (domains) {\n    var config = {\n      value: {\n        mode: 'pac_script',\n        pacScript: {\n          data: _this.generatePacScriptData(domains),\n          mandatory: false\n        }\n      },\n      scope: 'regular'\n    };\n    chrome.proxy.settings.set(config, function () {\n      console.warn('PAC has been set successfully!');\n    });\n  });\n\n  _defineProperty(this, \"generatePacScriptData\", function (domains) {\n    // The binary search works only with pre-sorted array.\n    domains.sort();\n    var http = 'proxy-nossl.roskomsvoboda.org:33333';\n    var https = 'proxy-ssl.roskomsvoboda.org:33333';\n    return \"\\nfunction FindProxyForURL(url, host) {\\n  function isHostBlocked(array, target) {\\n    let left = 0;\\n    let right = array.length - 1;\\n\\n    while (left <= right) {\\n      const mid = left + Math.floor((right - left) / 2);\\n\\n      if (array[mid] === target) {\\n        return true;\\n      }\\n\\n      if (array[mid] < target) {\\n        left = mid + 1;\\n      } else {\\n        right = mid - 1;\\n      }\\n    }\\n    return false;\\n  }\\n\\n  // Remove ending dot\\n  if (host.endsWith('.')) {\\n    host = host.substring(0, host.length - 1);\\n  }\\n\\n  // Make domain second-level.\\n  let lastDot = host.lastIndexOf('.');\\n  if (lastDot !== -1) {\\n    lastDot = host.lastIndexOf('.', lastDot - 1);\\n    if (lastDot !== -1) {\\n      host = host.substr(lastDot + 1);\\n    }\\n  }\\n\\n  // Domains, which are blocked.\\n  let domains = \".concat(JSON.stringify(domains), \";\\n\\n  // Return result\\n  if (isHostBlocked(domains, host)) {\\n    return 'HTTPS \").concat(https, \"; PROXY \").concat(http, \";';\\n  } else {\\n    return 'DIRECT';\\n  }\\n}\");\n  });\n\n  _defineProperty(this, \"removeProxy\", function () {\n    chrome.proxy.settings.clear({\n      scope: 'regular'\n    }, function () {\n      console.warn('Proxy auto-config disabled!');\n    });\n  });\n\n  _defineProperty(this, \"openPorts\", function () {\n    var proxyServerUrl = 'https://163.172.211.183:39263';\n    var request = new XMLHttpRequest();\n    request.open('GET', proxyServerUrl, true);\n    request.addEventListener('error', function (e) {\n      console.error(\"Error on opening ports: \".concat(e.target.status));\n    });\n    request.send(null);\n  });\n\n  _defineProperty(this, \"removeOutdatedBlockedDomains\", function () {\n    var monthInSeconds = 2628000;\n    chrome.storage.local.get({\n      blockedDomains: []\n    }, function (items) {\n      var blockedDomains = items.blockedDomains;\n\n      if (blockedDomains) {\n        blockedDomains = blockedDomains.filter(function (item) {\n          var timestamp = new Date().getTime();\n          return (timestamp - item.timestamp) / 1000 < monthInSeconds;\n        });\n      }\n\n      chrome.storage.local.set({\n        blockedDomains: blockedDomains\n      }, function () {\n        console.warn('Outdated domains has been removed.');\n\n        _this.setProxyAutoConfig(blockedDomains);\n      });\n    });\n  });\n\n  chrome.proxy.onProxyError.addListener(function (details) {\n    console.error(\"Proxy error: \".concat(JSON.stringify(details)));\n  });\n  setInterval(function () {\n    _this.syncDatabaseWithRegistry();\n  }, 60 * 60 * 1000 * 2);\n  setInterval(function () {\n    _this.removeOutdatedBlockedDomains();\n  }, 60 * 1000 * 60 * 60 * 2);\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (new Proxies());\n\n//# sourceURL=webpack:///./src/chrome/js/core/proxies.js?");

/***/ }),

/***/ "./src/chrome/js/core/registry.js":
/*!****************************************!*\
  !*** ./src/chrome/js/core/registry.js ***!
  \****************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index */ \"./src/chrome/js/core/index.js\");\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\nvar dbDomainItemName = 'domains';\nvar dbDistributorsItemName = 'distributors';\nvar db = new _index__WEBPACK_IMPORTED_MODULE_0__[\"Database\"]('censortracker-registry-db');\n\nvar Registry = function Registry() {\n  _classCallCheck(this, Registry);\n\n  _defineProperty(this, \"syncDatabase\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n    var apis, _loop, _i, _apis;\n\n    return regeneratorRuntime.wrap(function _callee$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            apis = [{\n              key: dbDomainItemName,\n              url: _index__WEBPACK_IMPORTED_MODULE_0__[\"settings\"].getDomainsApiUrl()\n            }, {\n              key: dbDistributorsItemName,\n              url: _index__WEBPACK_IMPORTED_MODULE_0__[\"settings\"].getRefusedApiUrl()\n            }];\n            _loop = /*#__PURE__*/regeneratorRuntime.mark(function _loop() {\n              var _apis$_i, key, url, response, domains;\n\n              return regeneratorRuntime.wrap(function _loop$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      _apis$_i = _apis[_i], key = _apis$_i.key, url = _apis$_i.url;\n                      _context.next = 3;\n                      return fetch(url);\n\n                    case 3:\n                      response = _context.sent;\n                      _context.next = 6;\n                      return response.json();\n\n                    case 6:\n                      domains = _context.sent;\n                      _context.next = 9;\n                      return db.set(key, {\n                        domains: domains,\n                        timestamp: new Date().getTime()\n                      }).catch(function (error) {\n                        console.error(\"Error on updating local \".concat(key, \" database: \").concat(error));\n                      });\n\n                    case 9:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _loop);\n            });\n            _i = 0, _apis = apis;\n\n          case 3:\n            if (!(_i < _apis.length)) {\n              _context2.next = 8;\n              break;\n            }\n\n            return _context2.delegateYield(_loop(), \"t0\", 5);\n\n          case 5:\n            _i++;\n            _context2.next = 3;\n            break;\n\n          case 8:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee);\n  })));\n\n  _defineProperty(this, \"getLastSyncTimestamp\", function () {\n    return new Promise(function (resolve, reject) {\n      db.get(dbDomainItemName).then(function (data) {\n        if (data && data.timestamp) {\n          resolve(data.timestamp);\n        }\n      }).catch(reject);\n    });\n  });\n\n  _defineProperty(this, \"checkDomains\", function (currentHostname, callbacks) {\n    var onMatchFoundCallback = callbacks.onMatchFound;\n    var onMatchNotFoundCallback = callbacks.onMatchNotFound;\n    db.get(dbDomainItemName).then(function (data) {\n      if (!data) {\n        return;\n      }\n\n      var domains = data.domains;\n      var matchFound = domains.find(function (domain) {\n        return currentHostname === _index__WEBPACK_IMPORTED_MODULE_0__[\"shortcuts\"].cleanHostname(domain);\n      });\n\n      if (matchFound) {\n        console.warn(\"Registry match found: \".concat(currentHostname));\n        onMatchFoundCallback(data);\n      } else if (onMatchNotFoundCallback !== undefined) {\n        onMatchNotFoundCallback();\n      }\n    }).catch(function (error) {\n      console.error(error);\n    });\n  });\n\n  _defineProperty(this, \"checkDistributors\", function (hostname, callbacks) {\n    var onMatchFoundCallback = callbacks.onMatchFound;\n    var onMatchNotFoundCallback = callbacks.onMatchNotFound;\n    db.get(dbDistributorsItemName).then(function (distributors) {\n      if (!distributors) {\n        return;\n      }\n\n      var domains = distributors.domains;\n      var cooperationRefused = false;\n      var matchFound = domains.find(function (item) {\n        return hostname === _index__WEBPACK_IMPORTED_MODULE_0__[\"shortcuts\"].cleanHostname(item.url);\n      });\n\n      if (matchFound) {\n        console.warn(\"Distributor match found: \".concat(hostname));\n\n        if ('cooperation_refused' in matchFound) {\n          cooperationRefused = matchFound.cooperation_refused;\n        }\n\n        onMatchFoundCallback(cooperationRefused);\n      } else if (onMatchNotFoundCallback !== undefined) {\n        onMatchNotFoundCallback();\n      }\n    }).catch(function (error) {\n      console.error(error);\n    });\n  });\n\n  _defineProperty(this, \"reportBlockedByDPI\", function (domain) {\n    chrome.storage.local.get({\n      alreadyReported: []\n    }, function (data) {\n      var alreadyReported = data.alreadyReported;\n\n      if (!alreadyReported.includes(domain)) {\n        fetch(_index__WEBPACK_IMPORTED_MODULE_0__[\"settings\"].getLoggingApiUrl(), {\n          method: 'POST',\n          headers: {\n            'Censortracker-D': new Date().getTime(),\n            'Censortracker-V': _index__WEBPACK_IMPORTED_MODULE_0__[\"settings\"].getVersion(),\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            domain: domain\n          })\n        }).then(function (response) {\n          return response.json();\n        }).then(function (response) {\n          if (response && response.status === 200) {\n            alreadyReported.push(domain);\n            chrome.storage.local.set({\n              alreadyReported: alreadyReported\n            }, function () {\n              console.warn(\"Reported: \".concat(domain));\n            });\n          }\n        });\n      } else {\n        console.warn(\"The domain \".concat(domain, \" reported\"));\n      }\n    });\n  });\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (new Registry());\n\n//# sourceURL=webpack:///./src/chrome/js/core/registry.js?");

/***/ }),

/***/ "./src/chrome/js/core/sessions.js":
/*!****************************************!*\
  !*** ./src/chrome/js/core/sessions.js ***!
  \****************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar BrowserSession = /*#__PURE__*/function () {\n  function BrowserSession() {\n    _classCallCheck(this, BrowserSession);\n\n    this.requests = new Map();\n  }\n\n  _createClass(BrowserSession, [{\n    key: \"putRequest\",\n    value: function putRequest(id, key, value) {\n      if (!this.requests.has(id)) {\n        this.requests.set(id, {});\n      }\n\n      this.requests.get(id)[key] = value;\n    }\n  }, {\n    key: \"getRequest\",\n    value: function getRequest(id, key, defaultValue) {\n      if (!this.requests.has(id)) {\n        return defaultValue;\n      }\n\n      var request = this.requests.get(id);\n      return typeof request[key] !== 'undefined' ? request[key] : defaultValue;\n    }\n  }, {\n    key: \"deleteRequest\",\n    value: function deleteRequest(id) {\n      if (this.requests.has(id)) {\n        this.requests.delete(id);\n      }\n    }\n  }]);\n\n  return BrowserSession;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (new BrowserSession());\n\n//# sourceURL=webpack:///./src/chrome/js/core/sessions.js?");

/***/ }),

/***/ "./src/chrome/js/core/settings.js":
/*!****************************************!*\
  !*** ./src/chrome/js/core/settings.js ***!
  \****************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar manifest = chrome.runtime.getManifest();\nvar rksUrl = 'https://reestr.rublacklist.net';\n\nvar Settings = function Settings() {\n  _classCallCheck(this, Settings);\n\n  _defineProperty(this, \"getName\", function () {\n    return manifest.name;\n  });\n\n  _defineProperty(this, \"getDescription\", function () {\n    return manifest.description;\n  });\n\n  _defineProperty(this, \"getVersion\", function () {\n    return manifest.version;\n  });\n\n  _defineProperty(this, \"getTitle\", function () {\n    return \"\".concat(manifest.name, \" v\").concat(manifest.version);\n  });\n\n  _defineProperty(this, \"getDomainsApiUrl\", function () {\n    return \"\".concat(rksUrl, \"/api/v3/domains/json\");\n  });\n\n  _defineProperty(this, \"getRefusedApiUrl\", function () {\n    return \"\".concat(rksUrl, \"/api/v3/ori/refused/json\");\n  });\n\n  _defineProperty(this, \"getLoggingApiUrl\", function () {\n    return 'https://ct-dev.rublacklist.net/api/domain/';\n  });\n\n  _defineProperty(this, \"getIconByName\", function (iconName) {\n    return chrome.extension.getURL(\"images/\".concat(iconName, \".png\"));\n  });\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (new Settings());\n\n//# sourceURL=webpack:///./src/chrome/js/core/settings.js?");

/***/ }),

/***/ "./src/chrome/js/core/shortcuts.js":
/*!*****************************************!*\
  !*** ./src/chrome/js/core/shortcuts.js ***!
  \*****************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar Shortcuts = function Shortcuts() {\n  _classCallCheck(this, Shortcuts);\n\n  _defineProperty(this, \"validURL\", function (urlStr) {\n    var pattern = new RegExp('^(https?:\\\\/\\\\/)?' + '((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|' + '((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))' + '(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*' + '(\\\\?[;&a-z\\\\d%_.~+=-]*)?' + '(\\\\#[-a-z\\\\d_]*)?$', 'i');\n    return !!pattern.test(urlStr);\n  });\n\n  _defineProperty(this, \"cleanHostname\", function (hostname) {\n    var regexp = /^(?:https?:\\/\\/)?(?:www\\.)?/i;\n    return hostname.replace(regexp, '').trim();\n  });\n\n  _defineProperty(this, \"createSearchLink\", function (hostname) {\n    var searchUrl = 'https://reestr.rublacklist.net/search/';\n    return \"<a href=\\\"\".concat(searchUrl, \"?q=\").concat(hostname, \"\\\" target=\\\"_blank\\\">\\u0414\\u0430</a>\");\n  });\n\n  _defineProperty(this, \"enableExtension\", function () {\n    chrome.storage.local.set({\n      enableExtension: true\n    }, function () {\n      console.warn('Extension enabled');\n    });\n  });\n\n  _defineProperty(this, \"disableExtension\", function () {\n    chrome.storage.local.set({\n      enableExtension: false\n    }, function () {\n      console.warn('Extension disabled');\n    });\n  });\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (new Shortcuts());\n\n//# sourceURL=webpack:///./src/chrome/js/core/shortcuts.js?");

/***/ })

/******/ });